# Cisco IOS/XR Plugin Documentation

## Overview

The Cisco IOS/XR vendor plugin provides comprehensive BGP configuration generation and validation for Cisco routers running both IOS and IOS-XR operating systems.

## Features

### ✅ **Fully Implemented**
- **Dual Platform Support**: Both Cisco IOS and IOS-XR
- **BGP Configuration Generation**: Complete BGP neighbor and policy configuration
- **Template-Based Generation**: Built-in Jinja2 templates for different peer types
- **Syntax Validation**: Platform-specific configuration validation
- **IPv4/IPv6 Dual-Stack**: Full support for both address families
- **Multiple Peer Types**: Standard peers, transit providers, route servers
- **Policy Generation**: Route-maps (IOS) and route-policies (IOS-XR)

### **Supported Peer Types**
1. **Standard Peers** (`ios_peer.j2`, `iosxr_peer.j2`)
2. **Transit Providers** (`ios_transit.j2`, `iosxr_transit.j2`)
3. **Route Servers** (`ios_route_server.j2`, `iosxr_route_server.j2`)

## Usage

### Basic Configuration Generation

```bash
# Generate Cisco IOS configuration
./autonet.py peer-config --asn AS64512 --vendor cisco --output cisco-peer.conf

# Generate for specific peer with details
./autonet.py peer-config \
  --asn AS64512 \
  --name "Example Peer" \
  --ipv4 192.0.2.100 \
  --ipv6 2001:db8::100 \
  --vendor cisco \
  --output example-peer-ios.conf
```

### Platform Configuration

Configure the Cisco plugin platform in your router configuration:

```yaml
# vars/generic.yml
bgp:
  cisco-ios-router:
    fqdn: r1.example.net
    ipv4: 192.0.2.1
    ipv6: 2001:db8::1
    vendor: cisco
    platform: ios        # Cisco IOS
    
  cisco-xr-router:
    fqdn: r2.example.net
    ipv4: 192.0.2.2
    ipv6: 2001:db8::2
    vendor: cisco
    platform: iosxr      # Cisco IOS-XR
```

### Plugin Configuration

The Cisco plugin supports these configuration options:

```yaml
# In plugin configuration or vars/generic.yml
cisco_plugin:
  platform: ios          # or iosxr
  template_dir: templates/cisco  # Custom template directory (optional)
```

## Configuration Examples

### Cisco IOS Standard Peer
```cisco
!
! BGP Configuration for AS64512 (Example Peer)
! Generated by AutoNet v2.0 for Cisco IOS
! Platform: IOS
!
router bgp 64500
 neighbor 192.0.2.100 remote-as 64512
 neighbor 192.0.2.100 description Example Peer
 neighbor 192.0.2.100 route-map RM-AS64512-IN in
 neighbor 192.0.2.100 route-map RM-AS64512-OUT out
 neighbor 192.0.2.100 maximum-prefix 1000
 address-family ipv6
  neighbor 2001:db8::100 remote-as 64512
  neighbor 2001:db8::100 description Example Peer
  neighbor 2001:db8::100 route-map RM-AS64512-IN in  
  neighbor 2001:db8::100 route-map RM-AS64512-OUT out
  neighbor 2001:db8::100 maximum-prefix 100
  neighbor 2001:db8::100 activate
 exit-address-family
exit
!
! Route-maps for AS64512
!
route-map RM-AS64512-IN permit 10
 set local-preference 100
exit
!
route-map RM-AS64512-OUT permit 10
exit
!
```

### Cisco IOS-XR Standard Peer
```cisco
!
! BGP Configuration for AS64512 (Example Peer)
! Generated by AutoNet v2.0 for Cisco IOS-XR
! Platform: IOSXR
!
router bgp 64500
 neighbor 192.0.2.100
  remote-as 64512
  description Example Peer
  address-family ipv4 unicast
   route-policy RM-AS64512-IN in
   route-policy RM-AS64512-OUT out
   maximum-prefix 1000
  exit
 exit
 neighbor 2001:db8::100
  remote-as 64512
  description Example Peer
  address-family ipv6 unicast
   route-policy RM-AS64512-IN in
   route-policy RM-AS64512-OUT out
   maximum-prefix 100
  exit
 exit
exit
!
! Route-policies for AS64512
!
route-policy RM-AS64512-IN
  set local-preference 100
  pass
end-policy
!
route-policy RM-AS64512-OUT
  pass
end-policy
!
```

## Advanced Features

### Peer Type Detection

The plugin automatically detects peer types based on peer information:

```python
# Peer information with type detection
peer_info = {
    'asn': 'AS64512',
    'name': 'Transit Provider',
    'ipv4': '192.0.2.100',
    'is_transit': True,        # Generates transit configuration
    'max_prefixes_v4': 50000   # Higher limits for transit
}

# or for route server
peer_info = {
    'asn': 'AS64512',
    'name': 'Route Server',
    'ipv4': '192.0.2.100',
    'is_route_server': True    # Generates route server configuration
}
```

### Custom Template Variables

```python
template_vars = {
    'local_asn': '64500',
    'router_id': '192.0.2.1',
    'bgp_local_pref': 150,         # Custom local preference
    'community_value': '64500:100' # Custom community
}
```

### Configuration Validation

The plugin includes comprehensive syntax validation:

```python
# The plugin validates:
# - Basic syntax (quotes, indentation)
# - Platform-specific syntax differences
# - BGP neighbor configuration format
# - Route-map/route-policy syntax
# - Address family configuration

config_valid = cisco_plugin.validate_config(generated_config)
```

## Platform Differences

### Cisco IOS vs IOS-XR

| Feature | IOS | IOS-XR |
|---------|-----|--------|
| **BGP Configuration** | `router bgp ASN` | `router bgp ASN` |
| **Neighbor Config** | Flat structure | Hierarchical |
| **IPv6 Support** | `address-family ipv6` | `address-family ipv6 unicast` |
| **Policy Language** | Route-maps | Route-policies |
| **Policy Syntax** | `route-map NAME permit 10` | `route-policy NAME` |
| **Configuration Mode** | Global config | Hierarchical config |

### Syntax Differences

**IOS Route-map:**
```cisco
route-map PEER-IN permit 10
 set local-preference 100
 match ip address prefix-list PEER-PREFIXES
exit
```

**IOS-XR Route-policy:**
```cisco
route-policy PEER-IN
  set local-preference 100
  if destination in PEER-PREFIXES then
    pass
  endif
end-policy
```

## Plugin Development

### Template Structure

The plugin uses built-in Jinja2 templates:

```
cisco_plugin.templates:
├── ios_peer.j2          # Standard IOS peer
├── ios_transit.j2       # IOS transit provider  
├── ios_route_server.j2  # IOS route server
├── iosxr_peer.j2        # Standard IOS-XR peer
├── iosxr_transit.j2     # IOS-XR transit provider
└── iosxr_route_server.j2 # IOS-XR route server
```

### Adding Custom Templates

```python
# Override template directory
cisco_plugin = CiscoVendorPlugin({
    'platform': 'ios',
    'template_dir': '/path/to/custom/templates'
})
```

### Template Variables Available

All templates have access to:

```python
{
    'peer': {
        'asn': 'AS64512',
        'name': 'Peer Name',
        'ipv4': '192.0.2.100',
        'ipv6': '2001:db8::100',
        'max_prefixes_v4': 1000,
        'max_prefixes_v6': 100
    },
    'platform': 'ios',          # or 'iosxr'
    'asn_number': '64512',       # ASN without 'AS' prefix
    'local_asn': '64500',
    'router_id': '192.0.2.1',
    'bgp_local_pref': 100,
    'route_map_in': 'RM-AS64512-IN',
    'route_map_out': 'RM-AS64512-OUT',
    'prefix_list_in': 'PL-AS64512-IN',
    'prefix_list_out': 'PL-AS64512-OUT'
}
```

## Testing

### Unit Testing

```bash
# Test the Cisco plugin
python -m pytest tests/unit/test_cisco_plugin.py -v

# Test configuration generation
./autonet.py peer-config --asn AS64512 --vendor cisco --validate-only
```

### Integration Testing

```bash
# List available plugins (should include cisco)
./autonet.py peer-config --list-vendors

# Generate and validate configuration
./autonet.py peer-config --asn AS64512 --vendor cisco --output test.conf
# Manually review test.conf for correctness
```

### Manual Validation

```bash
# For IOS configuration, you can validate using:
# - Cisco IOS simulator
# - GNS3 with IOS images
# - Cisco VIRL/CML

# For IOS-XR configuration, you can validate using:
# - Cisco IOS-XRv simulator
# - Cisco dCloud labs
# - XR CLI validator tools
```

## Troubleshooting

### Common Issues

**Plugin not found:**
```bash
# Check if plugin is loaded
./autonet.py peer-config --list-vendors
# Should show: cisco

# Check plugin status
./autonet.py --debug peer-config --list-vendors
```

**Configuration validation fails:**
```bash
# Enable debug logging
./autonet.py --debug peer-config --asn AS64512 --vendor cisco

# Check template rendering
./autonet.py peer-config --asn AS64512 --vendor cisco --output debug.conf
# Review debug.conf for syntax issues
```

**Wrong platform configuration:**
```bash
# Check platform setting
./autonet.py config show --key bgp.your-router.platform

# Should be either 'ios' or 'iosxr'
```

### Debug Mode

```python
# Enable plugin debug logging
import logging
logging.getLogger('plugins.vendors.cisco').setLevel(logging.DEBUG)

# Test plugin directly
from plugins.vendors.cisco import CiscoVendorPlugin

plugin = CiscoVendorPlugin({'platform': 'ios'})
peer_info = {'asn': 'AS64512', 'name': 'Test', 'ipv4': '192.0.2.1'}
config = plugin.generate_config(peer_info, {'local_asn': '64500'})
print(config)
```

## Contributing

### Adding New Features

1. **New Peer Types**: Add new template files
2. **Platform Support**: Extend platform detection
3. **Validation Rules**: Add to `_validate_ios_config()` or `_validate_iosxr_config()`
4. **Template Variables**: Extend `_prepare_render_vars()`

### Template Contributions

Custom templates should follow the naming convention:
- `{platform}_{peer_type}.j2`
- Platform: `ios` or `iosxr`
- Peer type: `peer`, `transit`, `route_server`, etc.

---

**Status**: ✅ **Production Ready**  
**Maintained by**: AutoNet Community  
**Last Updated**: October 2024